<div class="visualizar-farmacias">

  <div class="main-content">
    <div class="farmacias-page">
      <!-- Header -->
      <div class="page-header">
        <h1 class="page-title">Farmácias</h1>

        <div class="header-actions">
          <button type="button" class="btn-outline" (click)="onExportar()">
            Exportar
          </button>

          <button type="button" class="btn-primary" (click)="onCadastrarFarmacia()">
            Cadastrar farmácia
          </button>
        </div>
      </div>

      <!-- Filters -->
      <div class="card filters-card">
        <div class="filters-grid">
            <div class="select-field">
                <div class="field">
                  <label>Estado</label>
                  <select (change)="onEstadoChange($event)">
                    <option value="">Todos os estados</option>
                    <option *ngFor="let uf of estadosDisponiveis" [value]="uf">{{ uf }}</option>
                  </select>
                </div>
      
                <div class="field">
                  <label>Cidade</label>
                  <select (change)="onCidadeChange($event)">
                    <option value="">Todas as cidades</option>
                    <option *ngFor="let c of cidadesDisponiveis" [value]="c">{{ c }}</option>
                  </select>
                </div>
            </div>

          <div class="field search-field">
            <label>&nbsp;</label>
            <div class="search">
              <input
                type="text"
                placeholder="Buscar produto"
                (input)="onSearchChange($event)"
              />

              <span class="search-icon" aria-hidden="true">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                  <path
                    d="M11 19a8 8 0 1 1 0-16 8 8 0 0 1 0 16Z"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <path
                    d="m21 21-4.3-4.3"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Table -->
      <div class="card table-card">
        <div class="table-wrapper">
          <table class="farmacias-table">
            <thead>
              <tr>
                <th>Razão Social</th>
                <th>CNPJ</th>
                <th>Endereço</th>
                <th>E-mail</th>
                <th class="col-actions">Ações</th>
              </tr>
            </thead>

            <tbody>
              <tr *ngFor="let f of farmaciasPaginadas; trackBy: trackById">
                <td class="td-link">{{ f.razaoSocial }}</td>
                <td>{{ f.cnpj }}</td>
                <td class="td-muted">{{ f.endereco }}</td>
                <td class="td-muted">{{ f.email }}</td>

                <td class="actions-cell">
                  <div class="actions">
                    <button
                      type="button"
                      class="actions-btn"
                      (click)="toggleMenu(f.id, $event)"
                      aria-label="Abrir ações"
                    >
                      <img src="/assets/icones/menu-kebab.svg" alt="menu">
                    </button>

                    <!-- Mini modal -->
                    <div
                      class="row-menu"
                      *ngIf="menuAbertoId === f.id"
                      (click)="$event.stopPropagation()"
                    >
                      <button type="button" class="menu-item" (click)="onVerDetalhes(f)">
                        <span class="mi-icon" aria-hidden="true">
                          <img src="/assets/icones/olho.svg" alt="olho">
                        </span>
                        <span>Ver detalhes</span>
                      </button>

                      <button type="button" class="menu-item" (click)="onEditar(f)">
                        <span class="mi-icon" aria-hidden="true">
                          <img src="/assets/icones/lapis.svg" alt="lapis">
                        </span>
                        <span>Editar</span>
                      </button>

                      <button type="button" class="menu-item danger" (click)="onExcluir(f)">
                        <span class="mi-icon" aria-hidden="true">
                          <img src="/assets/icones/lixeira.svg" alt="lixeira">
                        </span>
                        <span>Excluir</span>
                      </button>
                    </div>
                  </div>
                </td>
              </tr>

              <tr *ngIf="farmaciasPaginadas.length === 0">
                <td colspan="5" class="empty">
                  Nenhuma farmácia encontrada com os filtros atuais.
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Footer (paginação) -->
        <div class="table-footer">
          <app-pagination
            [paginaAtual]="paginaAtual"
            [totalItens]="totalItens"
            [itensPorPagina]="itensPorPagina"
            (paginaMudou)="onPaginaMudou($event)"
          ></app-pagination>
        </div>
      </div>
    </div>
  </div>
</div>
